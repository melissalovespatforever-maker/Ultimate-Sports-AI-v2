<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <!-- GLOBAL LOGO SANITIZER (Must be available before any UI renders) -->
    <script>
        window.resolveSportsLogo = function(id, sport, url) {
            const fallback = 'https://play.rosebud.ai/assets/Ultimate sports logo match app layout.png?lZrN';
            
            try {
                // 1. DATA NORMALIZATION & EMERGENCY INTERCEPTION
                let urlStr = typeof url === 'string' ? url : (url && (url.href || url.url)) || '';
                const sportStr = String(sport || '').toUpperCase();
                
                // Extremely robust ID string conversion
                let idStr = '';
                if (typeof id === 'string') idStr = id.trim().toUpperCase();
                else if (typeof id === 'number') idStr = String(id);
                else if (id && id.id) idStr = String(id.id).trim().toUpperCase();
                
                // CRITICAL INTERCEPTION - Catch known broken ESPN URLs immediately before any other logic
                const urlLower = urlStr.toLowerCase();
                if (urlLower.includes('mci.png')) return 'https://a.espncdn.com/i/teamlogos/soccer/500/84.png';
                if (urlLower.includes('ars.png')) return 'https://a.espncdn.com/i/teamlogos/soccer/500/359.png';
                
                // If urlStr is empty and we have no valid ID, return fallback immediately
                if (!urlStr && !idStr) return fallback;

                // EMERGENCY BLOCKLIST: Never return these specific broken strings
                const blocklist = ['ars.png', 'mci.png', 'ars', 'mci'];
                if (blocklist.some(b => urlLower.endsWith(b) || idStr.toLowerCase() === b)) {
                     if (idStr.includes('ARS') || urlLower.includes('ars')) return 'https://a.espncdn.com/i/teamlogos/soccer/500/359.png';
                     if (idStr.includes('MCI') || urlLower.includes('mci')) return 'https://a.espncdn.com/i/teamlogos/soccer/500/84.png';
                }

                // EMERGENCY KILL-SWITCH FOR KNOWN BROKEN ESPN ABBREVIATIONS
                const isMCI = idStr === '84' || idStr === 'MCI' || idStr === 'MAN CITY' || idStr.includes('MANCHESTER CITY') || /mci\.png/i.test(urlStr);
                const isARS = idStr === '359' || idStr === 'ARS' || idStr === 'ARSENAL' || /ars\.png/i.test(urlStr);

                if (isMCI) return 'https://a.espncdn.com/i/teamlogos/soccer/500/84.png';
                if (isARS) return 'https://a.espncdn.com/i/teamlogos/soccer/500/359.png';

                // 2. SOCCER SPECIFIC LOGIC (ESPN soccer logos MUST be numeric IDs)
                if (sportStr === 'SOCCER' || sportStr === 'EPL' || urlLower.includes('/soccer/') || urlLower.includes('eng.1')) {
                    const soccerMap = {
                        'LIV': '364', 'MUN': '360', 'CHE': '363', 'TOT': '367', 'NEW': '361', 'AVL': '362', 
                        'WHA': '371', 'EVE': '368', 'LEI': '375', 'BHA': '331', 'CRY': '384', 'WOL': '380', 
                        'BRE': '337', 'FUL': '370', 'NFO': '393', 'BOU': '349', 'LUT': '346', 'SHU': '398',
                        'BUR': '374', 'IPS': '378', 'SOU': '376', 'WHT': '371', 'WHU': '371', 'LFC': '364', 'MU': '360',
                        'MCI': '84', 'MC': '84', 'ARS': '359', 'AR': '359'
                    };

                    if (soccerMap[idStr]) return `https://a.espncdn.com/i/teamlogos/soccer/500/${soccerMap[idStr]}.png`;
                    
                    // Check if URL contains an abbreviation that needs mapping
                    const match = urlStr.match(/\/soccer\/500\/([a-z]+)\.png/i);
                    if (match && match[1]) {
                        const abbr = match[1].toUpperCase();
                        if (soccerMap[abbr]) return `https://a.espncdn.com/i/teamlogos/soccer/500/${soccerMap[abbr]}.png`;
                    }

                    // If it's a numeric ID in the URL, keep it
                    if (/\/\d+\.png/.test(urlStr)) return urlStr;
                    
                    // If the ID itself is numeric, use it
                    if (/^\d+$/.test(idStr)) return `https://a.espncdn.com/i/teamlogos/soccer/500/${idStr}.png`;
                    
                    // Fallback for soccer: if not numeric, it's probably broken
                    if (!/\/\d+\.png/.test(urlStr) && urlStr.includes('espncdn.com')) return fallback;
                }

                // 3. GENERAL FALLBACK FOR OTHER SPORTS
                if (urlStr.length > 20 && urlStr.startsWith('http')) {
                    return urlStr;
                }

                if (!sportStr || !idStr) return fallback;

                const league = sportStr.toLowerCase() || 'nfl';
                const team = idStr.toLowerCase() || 'unknown';
                
                // Final safety: if we're about to return a known bad pattern, force fallback
                if (team === 'ars' || team === 'mci') {
                    return team === 'ars' ? 'https://a.espncdn.com/i/teamlogos/soccer/500/359.png' : 'https://a.espncdn.com/i/teamlogos/soccer/500/84.png';
                }
                
                return `https://a.espncdn.com/i/teamlogos/${league}/500/${team}.png`;
            } catch (e) {
                console.warn('Logo resolution error:', e);
                return fallback;
            }
        };

        // GLOBAL ERROR HEALER (Capture phase to stop bubbling)
        window.addEventListener('error', (event) => {
            if (event.target && event.target.tagName === 'IMG') {
                const img = event.target;
                const src = img.src || '';
                
                // Silently swallow empty source errors - they aren't critical
                if (!src || src === window.location.href || src.includes('data:image/gif;base64')) {
                    event.stopImmediatePropagation();
                    event.preventDefault();
                    return;
                }

                // Immediate rescue for MCI/ARS
                const mciUrl = 'https://a.espncdn.com/i/teamlogos/soccer/500/84.png';
                const arsUrl = 'https://a.espncdn.com/i/teamlogos/soccer/500/359.png';
                
                const isBrokenMCI = /mci\.png|(\/|_)mci(\/|_|\.)/i.test(src) || img.alt === 'MCI' || img.alt === 'Man City';
                const isBrokenARS = /ars\.png|(\/|_)ars(\/|_|\.)/i.test(src) || img.alt === 'ARS' || img.alt === 'Arsenal';
                
                if (isBrokenMCI) {
                    img.src = mciUrl;
                    event.stopImmediatePropagation();
                    event.preventDefault();
                    return;
                }
                if (isBrokenARS) {
                    img.src = arsUrl;
                    event.stopImmediatePropagation();
                    event.preventDefault();
                    return;
                }
                
                // Generic ESPN failure rescue
                if (src.includes('espncdn.com')) {
                    img.src = 'https://play.rosebud.ai/assets/Ultimate sports logo match app layout.png?lZrN';
                    event.stopImmediatePropagation();
                    event.preventDefault();
                }
            }
        }, true);

        // PROACTIVE SWEEPER (Heal broken logos before they even fail if possible)
        setInterval(() => {
            document.querySelectorAll('img[src*="mci.png"], img[src*="ars.png"], img[alt="MCI"], img[alt="ARS"]').forEach(img => {
                const src = img.src || '';
                if (/mci\.png/i.test(src)) img.src = 'https://a.espncdn.com/i/teamlogos/soccer/500/84.png';
                if (/ars\.png/i.test(src)) img.src = 'https://a.espncdn.com/i/teamlogos/soccer/500/359.png';
            });
        }, 500);

        // GLOBAL MESSAGE LISTENER (For Inter-Iframe Communication)
        window.addEventListener('message', (event) => {
            const data = event.data;
            if (!data || !data.action) return;

            switch(data.action) {
                case 'jackpot_celebration':
                    console.log('üé∞ MEGA JACKPOT DETECTED!', data);
                    if (window.confetti) {
                        window.confetti({
                            particleCount: 400,
                            spread: 120,
                            origin: { y: 0.3 },
                            colors: ['#fbbf24', '#f59e0b', '#10b981', '#ffffff', '#6366f1']
                        });
                    }
                    if (window.globalState && typeof window.globalState.showNotification === 'function') {
                        window.globalState.showNotification(
                            `üî• MEGA JACKPOT! You won ${data.payout.toLocaleString()} coins in ${data.game}!`,
                            'success'
                        );
                    }
                    break;
                
                case 'notify':
                    if (window.globalState && typeof window.globalState.showNotification === 'function') {
                        window.globalState.showNotification(data.message, data.type || 'info');
                    }
                    break;
                
                case 'navigate':
                    if (window.appNavigation && typeof window.appNavigation.navigateTo === 'function') {
                        window.appNavigation.navigateTo(data.page);
                    }
                    break;
            }
        });
    </script>

    <title>Ultimate Sports AI - Master Sports Analytics</title>

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Main Styles -->
    <link rel="stylesheet" href="styles.css?v=20250107002">
    <link rel="stylesheet" href="styles-premium.css?v=20250115001">
    <link rel="stylesheet" href="home-premium-layout.css?v=20250115001">
    <link rel="stylesheet" href="activity-feed-styles.css?v=20250107004">
    <link rel="stylesheet" href="ai-coach-card-styles.css?v=20250107002">
    <link rel="stylesheet" href="ai-coach-chat-styles.css?v=20250107002">
    <link rel="stylesheet" href="ai-coaches-espn-pro.css?v=20250215001">
    <link rel="stylesheet" href="settings-styles.css?v=20250107002">
    <link rel="stylesheet" href="live-scores-styles.css?v=20250107002">
    <link rel="stylesheet" href="my-bets-styles.css?v=20250107002">
    <link rel="stylesheet" href="profile-styles.css?v=20250107002">
    <link rel="stylesheet" href="transaction-history-modal.css">
    <link rel="stylesheet" href="two-factor-styles.css?v=20250107002">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Sports AI">
    <link rel="apple-touch-icon" href="https://play.rosebud.ai/assets/Ultimate sports logo match app layout.png?lZrN">
    <link rel="stylesheet" href="breadcrumb-styles.css?v=20250117001">
    <link rel="stylesheet" href="achievements-showcase-styles.css?v=20250117001">
    <link rel="stylesheet" href="daily-rewards-styles.css?v=20250215001">
    <link rel="stylesheet" href="daily-quest-styles.css?v=20250215001">
    <link rel="stylesheet" href="referral-system.css?v=20250215001">
    <link rel="stylesheet" href="tutorial-system.css?v=20250215001">
    <link rel="stylesheet" href="coach-battle-mode.css?v=20250215001">
    <link rel="stylesheet" href="shoutbox.css?v=20250215001">
    <link rel="stylesheet" href="trending-widget.css?v=20250215001">
    <link rel="stylesheet" href="global-search.css?v=20250215001">
    <link rel="stylesheet" href="player-profile-modal.css?v=20250215001">
    <link rel="stylesheet" href="live-commentary-overlay.css?v=20250215001">
    <link rel="stylesheet" href="public-sentiment-heatmap.css?v=20250215001">
    <link rel="stylesheet" href="betting-odds-tracker.css?v=20250215002">
    <link rel="stylesheet" href="global-odds-comparison.css?v=20250215003">
    <link rel="stylesheet" href="social-share-manager.css?v=20250215001">
    <link rel="stylesheet" href="smart-parlay-generator.css?v=20250215001">
    <link rel="stylesheet" href="value-bet-scanner.css?v=20250215001">
    <link rel="stylesheet" href="legend-trade-market.css?v=20250215001">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="app-loader" class="app-loader">
        <div class="loader-content">
            <div class="spinner"></div>
            <h2>Ultimate Sports AI</h2>
            <p>Loading your experience...</p>
        </div>
    </div>

    <!-- App Container -->
    <div id="app">
        <!-- Toast Container -->
        <div id="toast-container"></div>
        
        <!-- Top App Bar -->
        <header class="app-bar">
            <button id="menu-btn" class="icon-button" aria-label="Menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="app-title">
                <img src="https://play.rosebud.ai/assets/Ultimate sports logo match app layout.png?lZrN" alt="Ultimate Sports AI Logo" class="app-logo">
                <span>Ultimate Sports AI</span>
            </div>
            
            <div class="app-bar-actions">
                <!-- User Balance Display -->
                <div class="header-balance" id="header-user-balance" title="Ultimate Coins">
                    <i class="fas fa-coins"></i>
                    <span class="balance-amount">10,000</span>
                    <span id="save-indicator" style="display: none; font-size: 10px; color: #10b981; margin-left: 6px;">‚úì Saved</span>
                </div>

                <button class="icon-button" id="daily-quests-btn" title="Daily Quests" onclick="window.dailyQuests.renderToModal()">
                    <i class="fas fa-tasks"></i>
                </button>
                
                <button class="icon-button" id="notifications-btn" aria-label="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                
                <div id="header-tier-container" class="header-tier-container">
                    <!-- Badges injected by global-state-manager.js -->
                </div>

                <button class="icon-button profile-btn" data-page="profile" aria-label="Profile">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </header>

        <!-- Breadcrumb Navigation -->
        <div id="breadcrumb-container" class="breadcrumb-container hidden"></div>

        <!-- Notifications Dropdown -->
        <div id="notifications-dropdown" class="notifications-dropdown" style="display: none;">
            <div class="notifications-header">
                <div>
                    <h3 class="notifications-title">
                        <i class="fas fa-bolt"></i> Live Activity
                    </h3>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        LIVE
                    </div>
                </div>
                <button class="activity-feed-refresh" id="notifications-refresh" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            
            <!-- Activity Filters -->
            <div class="activity-filters">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-globe"></i> All
                </button>
                <button class="filter-btn" data-filter="achievement">
                    <i class="fas fa-trophy"></i> Badges
                </button>
                <button class="filter-btn" data-filter="game_win">
                    <i class="fas fa-coins"></i> Wins
                </button>
                <button class="filter-btn" data-filter="streak">
                    <i class="fas fa-fire"></i> Streaks
                </button>
                <button class="filter-btn" data-filter="tournament">
                    <i class="fas fa-medal"></i> Tournaments
                </button>
                <button class="filter-btn" data-filter="big_win">
                    <i class="fas fa-gem"></i> Mega
                </button>
                <button class="filter-btn" data-filter="sharp_alert">
                    <i class="fas fa-bolt"></i> Sharp
                </button>
                <button class="filter-btn" data-filter="whale_bet">
                    <i class="fas fa-whale"></i> Whales
                </button>
            </div>
            
            <div class="notifications-list" id="activity-feed-list">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Drawer Overlay -->
        <div id="drawer-overlay" class="drawer-overlay"></div>

        <!-- Drawer Navigation -->
        <nav id="drawer-nav" class="drawer">
            <div class="drawer-header">
                <div class="user-profile-section">
                    <div class="user-avatar" id="drawer-user-avatar">
                        üòä
                    </div>
                    <div class="user-info">
                        <h3 id="user-display-name">Sign In</h3>
                        <p class="user-tier" id="user-tier-badge">AUTHENTICATION REQUIRED</p>
                    </div>
                </div>
                <button id="upgrade-btn" class="upgrade-button">
                    <i class="fas fa-crown"></i> Upgrade to PRO
                </button>
            </div>

            <div class="drawer-menu">
                <!-- Dashboard -->
                <div class="menu-section">
                    <h4 class="menu-section-title">Dashboard</h4>
                    <button class="menu-item active" data-page="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </button>
                    <button class="menu-item" data-page="live-scores">
                        <i class="fas fa-play-circle"></i>
                        <span>Live Scores</span>
                        <span class="badge badge-live">LIVE</span>
                    </button>
                    <button class="menu-item" data-page="my-bets">
                        <i class="fas fa-receipt"></i>
                        <span>My Bets</span>
                        <span class="badge" id="pending-bets-count" style="display:none;">0</span>
                    </button>
                    <button class="menu-item" data-page="analytics">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </button>
                </div>

                <!-- AI & Pro Features -->
                <div class="menu-section">
                    <h4 class="menu-section-title">Pro Features</h4>
                    <button class="menu-item" data-page="ai-coaches">
                        <i class="fas fa-robot"></i>
                        <span>AI Coaches</span>
                        <span class="badge badge-pro">PRO</span>
                    </button>
                    <button class="menu-item" data-page="subscription">
                        <i class="fas fa-crown"></i>
                        <span>Premium Plans</span>
                    </button>
                </div>

                <!-- Social & Gaming -->
                <div class="menu-section">
                    <h4 class="menu-section-title">Social & Gaming</h4>
                    <button class="menu-item" data-page="sports-lounge">
                        <i class="fas fa-gamepad"></i>
                        <span>Sports Lounge</span>
                        <span class="badge badge-new">NEW</span>
                    </button>
                    <button class="menu-item" data-page="tournaments">
                        <i class="fas fa-trophy"></i>
                        <span>Tournaments</span>
                        <span class="badge badge-hot">üî•</span>
                    </button>
                    <button class="menu-item" data-page="hall-of-fame">
                        <i class="fas fa-ranking-star"></i>
                        <span>Hall of Fame</span>
                    </button>
                </div>

                <!-- Account -->
                <div class="menu-section">
                    <h4 class="menu-section-title">Account</h4>
                    <button class="menu-item" data-page="profile">
                        <i class="fas fa-user-circle"></i>
                        <span>My Profile</span>
                    </button>
                    <button class="menu-item" data-page="settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                    <button class="menu-item" id="admin-dashboard-btn" style="display: none;" onclick="window.location.href='/admin.html'">
                        <i class="fas fa-shield-alt"></i>
                        <span>Admin Dashboard</span>
                    </button>
                </div>

                <!-- Actions -->
                <div class="menu-section">
                    <button class="menu-item" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- HOME PAGE -->
            <div id="home-page" class="page active">
                <div class="page-header gradient-header">
                    <h1>üèÜ Welcome to Ultimate Sports AI</h1>
                    <p class="page-subtitle">Master sports analytics with AI-powered insights</p>
                </div>

                <div class="quick-actions">
                    <div class="quick-action-card" data-page="ai-coaches">
                        <div class="quick-action-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3>AI Coaches</h3>
                        <p>Get expert predictions</p>
                    </div>

                    <div class="quick-action-card" data-page="live-scores">
                        <div class="quick-action-icon">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <h3>Live Scores</h3>
                        <p>Real-time game tracking</p>
                    </div>

                    <div class="quick-action-card" data-page="analytics">
                        <div class="quick-action-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Analytics</h3>
                        <p>View your stats</p>
                    </div>

                    <div class="quick-action-card" data-page="subscription">
                        <div class="quick-action-icon">
                            <i class="fas fa-crown"></i>
                        </div>
                        <h3>Upgrade</h3>
                        <p>Unlock premium features</p>
                    </div>
                </div>

                <!-- Daily Summary -->
                <div id="daily-summary-container" class="dashboard-section"></div>

                <!-- Top Earners Leaderboard -->
                <div id="top-earners-container" class="dashboard-section"></div>

                <!-- Dashboard Widgets -->
                <div id="trending-now-container"></div>
                <div id="sentiment-heatmap-container"></div>
            </div>

            <!-- AUTH PAGE -->
            <div id="auth-page" class="page">
                <div class="auth-container">
                    <div class="auth-header">
                        <img src="https://play.rosebud.ai/assets/Ultimate sports logo match app layout.png?lZrN" alt="Logo" class="auth-logo">
                        <h1>Welcome to Ultimate Sports AI</h1>
                        <p>Master sports analytics with AI-powered insights</p>
                    </div>

                    <!-- Login Form -->
                    <div id="login-form" class="auth-form">
                        <h2>Sign In</h2>
                        <form id="login-form-element">
                            <div class="form-group">
                                <label for="login-email">Email</label>
                                <input type="email" id="login-email" placeholder="your@email.com" required>
                            </div>
                            <div class="form-group">
                                <label for="login-password">Password (min 8 characters)</label>
                                <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                        </form>

                        <div class="auth-divider">
                            <span>or continue with</span>
                        </div>

                        <div class="oauth-buttons">
                            <button class="btn btn-oauth" id="google-login-btn">
                                <i class="fab fa-google"></i> Google
                            </button>
                            <button class="btn btn-oauth" id="apple-login-btn">
                                <i class="fab fa-apple"></i> Apple
                            </button>
                        </div>

                        <p class="auth-switch">
                            Don't have an account? <a href="#" id="show-signup">Sign up</a> | 
                            <a href="#" id="forgot-password-link">Forgot password?</a>
                        </p>
                    </div>

                    <!-- Signup Form -->
                    <div id="signup-form" class="auth-form" style="display: none;">
                        <h2>Create Account</h2>
                        <form id="signup-form-element">
                            <div class="form-group">
                                <label for="signup-username">Username (min 3 characters, letters & numbers)</label>
                                <input type="text" id="signup-username" placeholder="johndoe123" required minlength="3" pattern="[a-zA-Z0-9]+">
                            </div>
                            <div class="form-group">
                                <label for="signup-email">Email</label>
                                <input type="email" id="signup-email" placeholder="your@email.com" required>
                            </div>
                            <div class="form-group">
                                <label for="signup-password">Password (min 8 characters)</label>
                                <input type="password" id="signup-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                        </form>

                        <div class="auth-divider">
                            <span>or continue with</span>
                        </div>

                        <div class="oauth-buttons">
                            <button class="btn btn-oauth" id="google-signup-btn">
                                <i class="fab fa-google"></i> Google
                            </button>
                            <button class="btn btn-oauth" id="apple-signup-btn">
                                <i class="fab fa-apple"></i> Apple
                            </button>
                        </div>

                        <p class="auth-switch">
                            Already have an account? <a href="#" id="show-login">Sign in</a>
                        </p>
                    </div>
                </div>
            </div>

            <!-- PASSWORD RESET PAGE -->
            <div id="password-reset-page" class="page">
                <div class="auth-container">
                    <div class="auth-header">
                        <img src="https://play.rosebud.ai/assets/Ultimate sports logo match app layout.png?lZrN" alt="Logo" class="auth-logo">
                        <h1>Reset Password</h1>
                        <p>Securely reset your account password</p>
                    </div>

                    <!-- Step 1: Request Reset -->
                    <div id="reset-request-step" class="auth-form">
                        <h2>Enter Your Email</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 24px; font-size: 14px;">
                            We'll send you a verification code to reset your password
                        </p>
                        <form id="reset-request-form">
                            <div class="form-group">
                                <label for="reset-email">Email Address</label>
                                <input type="email" id="reset-email" placeholder="your@email.com" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Send Reset Code</button>
                        </form>
                        <p class="auth-switch" style="text-align: center; margin-top: 24px;">
                            <a href="#" onclick="window.goBackToLoginFromReset(); return false;">Back to Sign In</a>
                        </p>
                    </div>

                    <!-- Step 2: Verify Code -->
                    <div id="reset-verify-step" class="auth-form" style="display: none;">
                        <h2>Verify Code</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 24px; font-size: 14px;">
                            Enter the 6-digit code sent to your email
                        </p>
                        <form id="reset-verify-form">
                            <div style="display: flex; gap: 8px; margin-bottom: 24px; justify-content: center;">
                                <input type="text" class="code-input" inputmode="numeric" maxlength="1" placeholder="0">
                                <input type="text" class="code-input" inputmode="numeric" maxlength="1" placeholder="0">
                                <input type="text" class="code-input" inputmode="numeric" maxlength="1" placeholder="0">
                                <input type="text" class="code-input" inputmode="numeric" maxlength="1" placeholder="0">
                                <input type="text" class="code-input" inputmode="numeric" maxlength="1" placeholder="0">
                                <input type="text" class="code-input" inputmode="numeric" maxlength="1" placeholder="0">
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Verify Code</button>
                        </form>
                        <p class="auth-switch" style="text-align: center; margin-top: 24px; font-size: 14px;">
                            Didn't receive code? <a href="#" onclick="document.getElementById('reset-request-form').reset(); window.passwordResetManager?.showRequestStep(); return false;">Resend</a>
                        </p>
                    </div>

                    <!-- Step 3: Reset Password -->
                    <div id="reset-password-step" class="auth-form" style="display: none;">
                        <h2>Create New Password</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 24px; font-size: 14px;">
                            Enter a strong password for your account
                        </p>
                        <form id="reset-password-form">
                            <div class="form-group">
                                <label for="reset-new-password">New Password (min 8 characters)</label>
                                <input type="password" id="reset-new-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
                                <div id="reset-password-strength-bar" style="height: 4px; background: var(--border-color); border-radius: 2px; margin-top: 8px; overflow: hidden;">
                                    <div id="reset-password-strength-fill" style="width: 0%; height: 100%; transition: all 0.3s ease;"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="reset-confirm-password">Confirm Password</label>
                                <input type="password" id="reset-confirm-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Reset Password</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- LIVE SCORES PAGE -->
            <div id="live-scores-page" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-play-circle"></i> Live Scores</h1>
                    <p class="page-subtitle">Real-time game tracking and scores</p>
                </div>
                <div id="live-scores-container" class="content-container">
                    <p class="loading-text">Loading live scores...</p>
                </div>
            </div>

            <!-- AI COACHES PAGE -->
            <div id="ai-coaches-page" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-robot"></i> AI Coaches</h1>
                    <p class="page-subtitle">Expert AI-powered predictions</p>
                </div>
                <div id="ai-coaches-container" class="content-container">
                    <p class="loading-text">Loading AI coaches...</p>
                </div>
            </div>

            <!-- ANALYTICS PAGE -->
            <div id="analytics-page" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-chart-line"></i> Analytics</h1>
                    <p class="page-subtitle">Track your performance metrics</p>
                </div>
                <div id="analytics-container" class="content-container">
                    <p class="loading-text">Loading analytics...</p>
                </div>
            </div>

            <!-- PROFILE PAGE -->
            <div id="profile-page" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-user-circle"></i> Profile</h1>
                    <p class="page-subtitle">Manage your account</p>
                </div>
                <div id="profile-container" class="content-container">
                    <!-- Profile View (Initially Hidden) -->
                    <div id="profile-view" style="display: none;">
                        <div style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 32px; max-width: 600px; margin: 0 auto;">
                            <div style="text-align: center; margin-bottom: 32px;">
                                <div style="font-size: 80px; color: var(--primary); margin-bottom: 16px;">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <h2 id="profile-name" style="margin: 0 0 8px;">User Name</h2>
                                <p id="profile-email" style="color: var(--text-secondary); margin: 0 0 16px;">user@email.com</p>
                                <div style="padding: 12px; background: var(--bg-tertiary); border-radius: 8px; display: inline-block;">
                                    <span style="font-weight: 600; color: var(--primary);">
                                        <i class="fas fa-crown"></i> 
                                        <span id="profile-tier">FREE TIER</span>
                                    </span>
                                </div>
                            </div>

                            <!-- Profile Info -->
                            <div style="border-top: 1px solid var(--border-color); padding-top: 24px; margin-bottom: 24px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                                    <div>
                                        <p style="color: var(--text-secondary); font-size: 12px; text-transform: uppercase; margin: 0 0 8px; font-weight: 600;">Member Since</p>
                                        <p id="profile-created" style="font-size: 16px; font-weight: 600; margin: 0;">-</p>
                                    </div>
                                    <div>
                                        <p style="color: var(--text-secondary); font-size: 12px; text-transform: uppercase; margin: 0 0 8px; font-weight: 600;">Account Status</p>
                                        <p style="font-size: 16px; font-weight: 600; margin: 0; color: var(--success);">
                                            <i class="fas fa-check-circle"></i> Active
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Stats & Achievements -->
                            <div style="border-top: 1px solid var(--border-color); padding-top: 24px; margin-bottom: 24px;">
                                <h3 style="margin: 0 0 16px; font-size: 18px;"><i class="fas fa-chart-line"></i> Your Progress</h3>
                                <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <span style="font-weight: 600;">Level <span id="profile-level">1</span></span>
                                        <span style="font-weight: 600;"><span id="profile-rank">Unranked</span></span>
                                    </div>
                                    <div style="background: var(--bg-tertiary); border-radius: 8px; height: 12px; overflow: hidden; margin-bottom: 8px;">
                                        <div id="profile-xp-bar" style="background: linear-gradient(90deg, var(--primary), var(--accent)); height: 100%; width: 0%; transition: width 0.5s;"></div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary);">
                                        <span><span id="profile-xp-current">0</span> XP</span>
                                        <span><span id="profile-xp-needed">100</span> XP to next level</span>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: var(--primary);" id="profile-login-streak">0</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">üî• Day Streak</div>
                                    </div>
                                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: var(--accent);" id="profile-achievements">0/30</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">üèÜ Achievements</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Achievements Showcase -->
                            <div id="achievements-showcase-container"></div>

                            <!-- Actions -->
                            <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 32px;">
                                <button class="btn btn-primary btn-block" onclick="window.open('badge-collection.html', '_blank')">
                                    <i class="fas fa-medal"></i> View Badge Collection
                                </button>
                                <button class="btn btn-primary btn-block" data-page="sports-lounge">
                                    <i class="fas fa-gamepad"></i> Sports Lounge & Inventory
                                </button>
                                <button id="transaction-history-btn" class="btn btn-primary btn-block" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                    <i class="fas fa-history"></i> Transaction History
                                </button>
                                <button id="edit-profile-btn" class="btn btn-secondary btn-block">
                                    <i class="fas fa-edit"></i> Edit Profile
                                </button>
                                <button id="change-password-btn" class="btn btn-secondary btn-block">
                                    <i class="fas fa-lock"></i> Change Password
                                </button>
                                <button id="profile-logout-btn" class="btn btn-secondary btn-block">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Profile Form (Initially Hidden) -->
                    <div id="profile-edit" style="display: none;">
                        <div style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 32px; max-width: 600px; margin: 0 auto;">
                            <h2 style="margin: 0 0 24px; text-align: center;">Edit Profile</h2>
                            <form id="edit-profile-form">
                                <div class="form-group">
                                    <label for="edit-name">Full Name</label>
                                    <input type="text" id="edit-name" placeholder="John Doe" required>
                                </div>
                                <div class="form-group">
                                    <label for="edit-email">Email</label>
                                    <input type="email" id="edit-email" placeholder="john@example.com" required>
                                </div>
                                <div style="display: flex; gap: 12px;">
                                    <button type="submit" class="btn btn-primary btn-block">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                    <button type="button" class="btn btn-secondary btn-block" id="cancel-edit-btn">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Change Password Form (Initially Hidden) -->
                    <div id="profile-password" style="display: none;">
                        <div style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 32px; max-width: 600px; margin: 0 auto;">
                            <h2 style="margin: 0 0 24px; text-align: center;">Change Password</h2>
                            <form id="change-password-form">
                                <div class="form-group">
                                    <label for="current-password">Current Password</label>
                                    <input type="password" id="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                </div>
                                <div class="form-group">
                                    <label for="new-password">New Password</label>
                                    <input type="password" id="new-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                </div>
                                <div class="form-group">
                                    <label for="confirm-password">Confirm Password</label>
                                    <input type="password" id="confirm-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                </div>
                                <div style="display: flex; gap: 12px;">
                                    <button type="submit" class="btn btn-primary btn-block">
                                        <i class="fas fa-lock"></i> Update Password
                                    </button>
                                    <button type="button" class="btn btn-secondary btn-block" id="cancel-password-btn">
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Not Logged In Message (Initially Hidden) -->
                    <div id="profile-not-logged-in" style="display: none; text-align: center; padding: 60px 24px;">
                        <div style="font-size: 64px; color: var(--text-muted); margin-bottom: 24px;">
                            <i class="fas fa-lock-open"></i>
                        </div>
                        <h2 style="margin-bottom: 12px;">Not Logged In</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 32px;">Sign in to view your profile</p>
                        <button class="btn btn-primary" onclick="window.appNavigation.navigateTo('auth')">
                            Sign In
                        </button>
                    </div>
                </div>
            </div>

            <!-- SUBSCRIPTION PAGE -->
            <div id="subscription-page" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-crown"></i> Subscription</h1>
                    <p class="page-subtitle">Choose your plan</p>
                </div>
                <div id="subscription-container" class="content-container">
                    <div class="pricing-grid">
                        <div class="pricing-card">
                            <h3>FREE</h3>
                            <div class="price">$0<span>/month</span></div>
                            <ul class="features">
                                <li><i class="fas fa-check"></i> Basic live scores</li>
                                <li><i class="fas fa-check"></i> Limited AI predictions</li>
                                <li><i class="fas fa-check"></i> Community access</li>
                            </ul>
                            <button class="btn btn-secondary btn-block" disabled>Current Plan</button>
                        </div>

                        <div class="pricing-card featured">
                            <div class="featured-badge">MOST POPULAR</div>
                            <h3>PRO</h3>
                            <div class="price">$14.99<span>/month</span></div>
                            <ul class="features">
                                <li><i class="fas fa-check"></i> All FREE features</li>
                                <li><i class="fas fa-check"></i> Unlimited AI predictions</li>
                                <li><i class="fas fa-check"></i> Advanced analytics</li>
                                <li><i class="fas fa-check"></i> Real-time odds comparison</li>
                                <li><i class="fas fa-check"></i> Priority support</li>
                            </ul>
                            <button class="btn btn-primary btn-block" id="subscribe-pro-btn">Upgrade to PRO</button>
                        </div>

                        <div class="pricing-card">
                            <h3>VIP</h3>
                            <div class="price">$29.99<span>/month</span></div>
                            <ul class="features">
                                <li><i class="fas fa-check"></i> All PRO features</li>
                                <li><i class="fas fa-check"></i> Exclusive AI models</li>
                                <li><i class="fas fa-check"></i> 1-on-1 coaching sessions</li>
                                <li><i class="fas fa-check"></i> Early feature access</li>
                                <li><i class="fas fa-check"></i> VIP community</li>
                            </ul>
                            <button class="btn btn-primary btn-block" id="subscribe-vip-btn">Upgrade to VIP</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS PAGE -->
            <div id="settings-page" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-cog"></i> Settings</h1>
                    <p class="page-subtitle">Configure your preferences</p>
                </div>
                <div id="settings-container" class="content-container">
                    <p class="loading-text">Loading settings...</p>
                </div>
            </div>

            <!-- SPORTS LOUNGE PAGE -->
            <!-- MY BETS PAGE -->
            <div id="my-bets-page" class="page">
                <!-- Content loaded from my-bets.html -->
            </div>

            <!-- TOURNAMENTS PAGE -->
            <div id="tournaments-page" class="page">
                <div class="page-header">
                    <h1><i class="fas fa-trophy"></i> Tournaments</h1>
                    <p class="page-subtitle">Compete and win big prizes</p>
                </div>
                <div id="tournaments-container" class="content-container">
                    <p class="loading-text">Loading tournaments...</p>
                </div>
            </div>

            <div id="sports-lounge-page" class="page">
                <iframe 
                    id="sports-lounge-frame" 
                    src="sports-lounge.html" 
                    style="width: 100%; height: calc(100vh - 120px); border: none; display: block;"
                    title="Sports Lounge">
                </iframe>
            </div>

            <div id="hall-of-fame-page" class="page">
                <iframe 
                    id="hall-of-fame-frame" 
                    src="leaderboard-badges.html" 
                    style="width: 100%; height: calc(100vh - 120px); border: none; display: block;"
                    title="Hall of Fame">
                </iframe>
            </div>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <button class="bottom-nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="bottom-nav-item" data-page="live-scores">
                <i class="fas fa-play-circle"></i>
                <span>Live</span>
            </button>
            <button class="bottom-nav-item" data-page="ai-coaches">
                <i class="fas fa-robot"></i>
                <span>AI</span>
            </button>
            <button class="bottom-nav-item" data-page="analytics">
                <i class="fas fa-chart-line"></i>
                <span>Stats</span>
            </button>
            <button class="bottom-nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
        </nav>
    </div>

    <!-- Core App & Navigation (Load First) -->
    <!-- 
      SYSTEM LOADING ORDER NOTES:
      1. Age Verification: Must run before any content is shown for legal compliance.
      2. Global State: Initializes the central data store.
      3. Error Handlers & Services: Sets up the infrastructure.
      4. Core Systems: App logic, tutorials, rewards.
      5. WebSocket: Real-time connection.
      6. Auth & Modules: User session and specific features.
    -->
    <!-- Age Verification (MUST LOAD FIRST) -->
    <script src="age-verification.js?v=20250214001"></script>
    
    <!-- GLOBAL CONFIGURATION (MUST LOAD BEFORE STATE) -->
    <script src="config.js?v=20250215001"></script>
    
    <!-- ASSET MAPPINGS (LOAD BEFORE STATE) -->
    <script src="asset-mappings.js?v=20250215001"></script>
    
    <!-- GLOBAL STATE MANAGER (MUST LOAD BEFORE EVERYTHING) -->
    <script src="global-state-manager.js?v=20250215002"></script>
    
    <!-- UNIFIED BALANCE MANAGER (SINGLE SOURCE OF TRUTH FOR COINS) -->
    <script src="unified-balance-manager.js?v=20250215002"></script>
    
    <!-- UNIFIED INVENTORY MANAGER (SINGLE SOURCE OF TRUTH FOR ITEMS) -->
    <script src="unified-inventory-manager.js?v=20250215002"></script>
    
    <!-- TRANSACTION QUEUE MANAGER (LOAD AFTER GLOBAL STATE) -->
    <script src="transaction-queue-manager.js?v=20250215001"></script>
    
    <!-- Error Handling -->
    <script src="auth-error-handler.js?v=20250215001"></script>
    <script src="sports-data-service.js?v=20250215001"></script>
    
    <!-- Core Systems (Load First) -->
    <script src="achievements-system.js?v=20250117001"></script>
    <script src="achievements-showcase.js?v=20250117001"></script>
    <script src="daily-rewards-system.js?v=20250215001"></script>
    <script src="daily-quest-system.js?v=20250215001"></script>
    <script src="mystery-box-system.js?v=20250215001"></script>
    <script src="daily-summary-card.js?v=20250215001"></script>
    <script src="top-earners-widget.js?v=20250215001"></script>
    <script src="referral-system.js?v=20250215001"></script>
    <script src="tutorial-system.js?v=20250215001"></script>
    <script src="breadcrumb-manager.js?v=20250117001"></script>
    <script src="app.js?v=20250101012"></script>
    
    <!-- WebSocket Client (MUST LOAD BEFORE live-scores.js) -->
    <script type="module" src="websocket-client.js?v=20250214002"></script>
    
    <!-- User Authentication & Profile -->
    <script src="auth.js?v=20250101012"></script>
    <script src="password-reset.js?v=20250101012"></script>
    <script src="profile.js?v=20250101012"></script>
    <script src="transaction-history-modal.js"></script>
    
    <!-- Core Modules -->
    <script src="tier-restrictions.js?v=20250107003"></script>
    <script src="upgrade-prompt.js?v=20250107003"></script>
    <script src="live-scores.js?v=20250214002"></script>
    <script src="ai-coaches-espn-pro.js?v=20250215001"></script>
    <script src="ai-coach-chat.js?v=20250101012"></script>
    <script src="paypal-shop-integration.js?v=20250215001"></script>
    <script src="shop-system.js?v=20250215001"></script>
    <script src="subscription.js?v=20250101012"></script>
    
    <!-- UI & Experience -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="activity-feed.js?v=20250107004"></script>
    <script src="confetti.js?v=20250107001"></script>
    <script src="sound-effects.js?v=20250107001"></script>
    <script src="premium-animations.js?v=20250115001"></script>
    <script src="two-factor-auth.js?v=20250107002"></script>
    <script src="tournaments-simple.js?v=20250214001"></script>
    <script src="analytics-frontend.js?v=20250214001"></script>
    <script src="settings-frontend.js?v=20250214001"></script>
    <script src="profile-inventory.js?v=20250214001"></script>
    <script src="backend-diagnostics.js?v=20250214001"></script>
    <script src="shoutbox.js?v=20250215001"></script>
    <script src="trending-widget.js?v=20250215001"></script>
    <script src="public-sentiment-heatmap.js?v=20250215001"></script>
    <script src="global-search.js?v=20250215001"></script>
    <script src="player-profile-modal.js?v=20250215001"></script>
    <script src="live-commentary-overlay.js?v=20250215001"></script>
    <script src="betting-odds-tracker.js?v=20250215002" type="module"></script>
    <script src="global-odds-comparison.js?v=20250215003"></script>
    <script src="paper-trading-leaderboard.js?v=20250215001"></script>
    <script src="smart-parlay-generator.js?v=20250215001"></script>
    <script src="value-bet-scanner.js?v=20250215001"></script>
    <script type="module" src="social-share-manager.js?v=20250215001"></script>
    <script src="season-manager.js?v=20250215001"></script>
    <script type="module">
        import { LegendTradeMarket } from './legend-trade-market.js';
        window.LegendTradeMarketClass = LegendTradeMarket;
    </script>

    <script>
        // App initialization complete
        document.addEventListener('DOMContentLoaded', () => {
            // Navigation and core modules auto-initialize
            
            // Debug: Test backend connectivity on load (console only)
            console.log('üîç Testing backend connectivity...');
            console.log('üì° Backend URL:', window.CONFIG?.API_BASE_URL || 'https://ultimate-sports-ai-backend-production.up.railway.app');
            console.log('üí° To run full diagnostics, type: await runBackendDiagnostics()');
        });
    </script>
</body>
</html>
