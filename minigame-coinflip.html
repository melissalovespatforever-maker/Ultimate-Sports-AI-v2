<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ultimate Plinko ðŸ˜Ž</title>
<style>
body {
  margin:0;
  background:#060a1a;
  color:white;
  font-family:Arial, sans-serif;
  text-align:center;
}

canvas {
  display:block;
  margin:20px auto;
  background:radial-gradient(circle at top, #0c1435, #02030a);
  border-radius:18px;
  box-shadow:0 0 30px #00ffff55;
}

.panel {
  width:360px;
  margin:auto;
  padding:14px;
  background:#0e1433;
  border-radius:14px;
}
button, input {
  width:95%;
  padding:8px;
  margin-top:6px;
  border-radius:8px;
  border:none;
}
button { background:#00bcd4; color:black; font-weight:bold; }
</style>
</head>
<body>

<h3>ðŸŸ£ Ultimate Plinko ðŸ˜Ž</h3>

<canvas id="game" width="420" height="560"></canvas>

<div class="panel">
ðŸ’° Balance: <span id="bal">1000</span><br>
Bet:
<input id="bet" type="number" value="50">
<button id="dropBtn">DROP BALL</button>

<b>Upgrades</b><br>
<button onclick="buy('double')">Double Balls ($200)</button>
<button onclick="buy('smart')">Smart Ball ($150)</button>
<button onclick="buy('action')">Action Ball ($250)</button>
</div>

<div id="msg"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

ctx.font = "14px Arial";

let balance = 1000;
let balls = [];
let pegs = [];
let secret = false;

const upgrades = { double:false, smart:false, action:false };

const betInput = document.getElementById("bet");
const balEl = document.getElementById("bal");
const msg = document.getElementById("msg");

const gravity = 0.35;

// -------- PEG BOARD --------
for (let r=0;r<7;r++){
  for (let i=0;i<=r;i++){
    pegs.push({
      x: canvas.width/2 + (i-r/2)*50,
      y: 90 + r*55,
      r: 6,
      move: Math.random()<0.15,
      dir: Math.random()<0.5?-1:1
    });
  }
}

// -------- SLOTS --------
let slots = [-1,-0.5,1,2,5,2,1,-0.5,-1];

// -------- DRAW --------
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  pegs.forEach(p=>{
    if(p.move){
      p.x += p.dir*0.4;
      if(Math.random()<0.01) p.dir*=-1;
    }
    ctx.fillStyle = p.gold ? "gold" : "#00ffff";
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  });

  const w = canvas.width / slots.length;
  slots.forEach((s,i)=>{
    ctx.fillStyle = s<0?"#ff0033":"#222";
    ctx.fillRect(i*w,canvas.height-50,w-2,50);
    ctx.fillStyle="white";
    ctx.fillText(s+"x",i*w+10,canvas.height-20);
  });

  balls.forEach(b=>{
    ctx.fillStyle = b.action?"#ff00ff":"#00ffcc";
    ctx.beginPath();
    ctx.arc(b.x,b.y,7,0,Math.PI*2);
    ctx.fill();
  });
}

// -------- LOOP --------
function update(){
  balls.forEach(b=>{
    b.vy += gravity;
    b.x += b.vx;
    b.y += b.vy;

    pegs.forEach(p=>{
      const dx=b.x-p.x, dy=b.y-p.y;
      if(Math.hypot(dx,dy)<13){
        b.vy*=-0.6;
        b.vx += upgrades.smart?dx*0.01:dx*0.05;

        if(!secret && Math.random()<0.02){
          p.gold=true;
          secret=true;
          slots=[2,3,5,10,5,3,2];
          msg.innerHTML="ðŸŸ¡ SECRET STAGE!";
        }
      }
    });

    if(b.y>canvas.height-50){
      settle(b);
    }
  });

  balls = balls.filter(b=>!b.done);
}

// -------- SETTLE --------
function settle(b){
  const w = canvas.width / slots.length;
  let i = Math.floor(b.x/w);
  i = Math.max(0,Math.min(slots.length-1,i));
  const win = Math.floor(b.bet*slots[i]);
  balance += win;
  msg.innerHTML = `Result: ${slots[i]}x (${win>=0?'+':'-'}$${Math.abs(win)})`;
  b.done=true;
  balEl.textContent = balance;
}

// -------- DROP --------
document.getElementById("dropBtn").onclick = ()=>{
  const bet = Number(betInput.value);
  if(bet<=0||bet>balance) return;

  balance -= bet;
  balEl.textContent = balance;

  spawn(bet);
  if(upgrades.double) spawn(bet);
};

function spawn(bet){
  balls.push({
    x: canvas.width/2 + Math.random()*8-4,
    y:20,
    vx:Math.random()*2-1,
    vy:1,
    bet,
    action:upgrades.action
  });
}

// -------- UPGRADES --------
function buy(t){
  const cost={double:200,smart:150,action:250}[t];
  if(balance<cost) return;
  balance-=cost;
  upgrades[t]=true;
  balEl.textContent=balance;
}

// -------- MAIN LOOP --------
function loop(){
  draw();
  update();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
