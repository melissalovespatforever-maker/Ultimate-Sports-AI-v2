<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ultimate Horse Racing üêé</title>

<style>
body{
  margin:0;
  background:#050b1e;
  font-family:Arial, sans-serif;
  color:#eaffff;
  text-align:center;
}

h2{
  color:#ffd700;
  text-shadow:0 0 12px #ffcc0066;
}

canvas{
  display:block;
  margin:10px auto;
  background:#000;
  border-radius:18px;
  box-shadow:0 0 35px #00ffff55;
}

.panel{
  width:420px;
  margin:auto;
  padding:12px;
  background:#0b1d33;
  border-radius:14px;
}

select,input,button{
  width:95%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:none;
}

button{
  background:linear-gradient(135deg,#ffd700,#ffb300);
  font-weight:bold;
}

#announcer{
  margin-top:10px;
  font-size:16px;
  color:#00ffff;
  min-height:22px;
  text-shadow:0 0 10px #00ffff99;
}
</style>
</head>

<body>

<h2>üèÅ Ultimate Horse Racing</h2>

<canvas id="race" width="540" height="380"></canvas>

<div class="panel">
üí∞ Balance: $<span id="bal">1000</span><br>

Horse:
<select id="pick"></select>

Bet:
<input id="bet" type="number" value="100">

<div id="odds"></div>

<button onclick="startRace()">START RACE</button>
</div>

<div id="announcer"></div>

<script>
const canvas=document.getElementById("race");
const ctx=canvas.getContext("2d");

const bal=document.getElementById("bal");
const oddsBox=document.getElementById("odds");
const announcer=document.getElementById("announcer");
const pick=document.getElementById("pick");

let balance=1000;
let racing=false;
let camX=0;
const finish=2600;

const trackImg=new Image();
trackImg.src="img/track.png";

const horses=[];
const colors=["#ff4444","#44ff44","#4488ff","#ff44ff","#ffff44","#ff8844"];

// ---- CREATE HORSES ----
for(let i=0;i<6;i++){
  const img=new Image();
  img.src=`img/horse${i+1}.png`;

  const speed=1.5+Math.random()*1.6;
  const stamina=100+Math.random()*70;
  const rating=speed*stamina;

  horses.push({
    id:i,
    name:`Horse ${i+1}`,
    x:0,
    y:70+i*50,
    speed,
    stamina,
    rating,
    odds:0,
    img,
    frame:0,
    finished:false,
    color:colors[i]
  });

  pick.innerHTML+=`<option value="${i}">Horse ${i+1}</option>`;
}

// ---- ODDS ----
function calcOdds(){
  let total=horses.reduce((s,h)=>s+h.rating,0);
  oddsBox.innerHTML="<b>üìä ODDS</b><br>";
  horses.forEach(h=>{
    h.odds=(total/h.rating).toFixed(2);
    oddsBox.innerHTML+=`${h.name}: ${h.odds}x<br>`;
  });
}
calcOdds();

// ---- ANNOUNCER ----
let lastLeader=-1;
function announce(text){
  announcer.textContent=text;
}

// ---- DRAW ----
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(trackImg.complete){
    ctx.drawImage(trackImg,-camX,0,3000,canvas.height);
  }

  // finish line
  ctx.fillStyle="#fff";
  ctx.fillRect(finish-camX,0,6,canvas.height);

  horses.forEach(h=>{
    const x=h.x-camX+60;
    const y=h.y;

    if(h.img.complete){
      ctx.drawImage(h.img,x-28,y-18,56,36);
    }else{
      ctx.fillStyle=h.color;
      ctx.fillRect(x-20,y-10,40,20);
    }
  });
}

// ---- UPDATE ----
function update(){
  let lead=0, leader=null;

  horses.forEach(h=>{
    if(h.finished)return;

    let pace=h.speed*(h.stamina>40?1:0.7);
    if(Math.random()<0.02) pace+=1.4;

    h.x+=pace;
    h.stamina-=0.15;
    h.frame++;

    if(h.x>lead){
      lead=h.x;
      leader=h;
    }

    if(h.x>=finish){
      h.finished=true;
      if(racing) finishRace(h);
    }
  });

  if(leader && leader.id!==lastLeader){
    announce(`${leader.name} takes the lead!`);
    lastLeader=leader.id;
  }

  camX=lead-140;
}

// ---- LOOP ----
function loop(){
  if(!racing)return;
  update();
  draw();
  requestAnimationFrame(loop);
}

// ---- START ----
function startRace(){
  if(racing)return;

  const bet=Number(document.getElementById("bet").value);
  if(bet<=0||bet>balance)return;

  balance-=bet;
  bal.textContent=balance;

  horses.forEach(h=>{
    h.x=0;
    h.stamina=100+Math.random()*70;
    h.finished=false;
  });

  announce("üèÅ They're off and racing!");
  lastLeader=-1;
  racing=true;
  loop();
}

// ---- FINISH ----
function finishRace(winner){
  racing=false;
  const choice=Number(pick.value);
  const bet=Number(document.getElementById("bet").value);

  if(winner.id===choice){
    const payout=Math.floor(bet*winner.odds);
    balance+=payout;
    announce(`üèÜ ${winner.name} WINS! +$${payout}`);
  }else{
    announce(`‚ùå ${winner.name} wins the race.`);
  }

  bal.textContent=balance;
  calcOdds();
}
</script>

</body>
</html>
