<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Horse Racing Simulator</title>
<style>
  body {
    background:#1b1b1b;
    color:#fff;
    font-family:Arial, sans-serif;
    text-align:center;
  }
  canvas {
    background:#2e7d32;
    display:block;
    margin:20px auto;
    border:3px solid #444;
  }
  .panel {
    margin:10px auto;
    padding:10px;
    background:#222;
    width:320px;
    border-radius:8px;
  }
  button {
    padding:8px 14px;
    margin:6px;
    cursor:pointer;
  }
  select, input {
    padding:5px;
  }
</style>
</head>
<body>

<h2>üèá Horse Racing Simulator</h2>

<canvas id="raceCanvas" width="800" height="300"></canvas>

<div class="panel">
  üí∞ Balance: $<span id="balance">1000</span><br><br>

  Bet Horse:
  <select id="horseSelect"></select><br><br>

  Wager:
  <input type="number" id="betAmount" value="100" min="10"><br><br>

  <button onclick="startRace()">Start Race</button>
</div>

<div id="result"></div>

<script>
const canvas = document.getElementById("raceCanvas");
const ctx = canvas.getContext("2d");

let balance = 1000;
let racing = false;

const horses = [];

function createHorses() {
  horses.length = 0;
  for (let i = 0; i < 5; i++) {
    horses.push({
      name: "Horse " + (i + 1),
      x: 10,
      y: 40 + i * 50,
      speed: Math.random() * 1.5 + 1.5,
      stamina: Math.random() * 200 + 200,
      finished: false
    });
  }
}

function populateSelect() {
  const select = document.getElementById("horseSelect");
  select.innerHTML = "";
  horses.forEach((h, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = h.name;
    select.appendChild(opt);
  });
}

function drawTrack() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#fff";
  ctx.fillRect(canvas.width - 80, 0, 5, canvas.height);

  horses.forEach(h => {
    ctx.fillStyle = "brown";
    ctx.fillRect(h.x, h.y, 40, 20);
    ctx.fillStyle = "#fff";
    ctx.fillText(h.name, h.x, h.y - 5);
  });
}

function startRace() {
  if (racing) return;

  const bet = parseInt(document.getElementById("betAmount").value);
  const pick = document.getElementById("horseSelect").value;

  if (bet > balance || bet <= 0) {
    alert("Invalid bet");
    return;
  }

  balance -= bet;
  updateBalance();

  racing = true;
  document.getElementById("result").innerHTML = "";
  createHorses();
  populateSelect();
  raceLoop(bet, pick);
}

function raceLoop(bet, pick) {
  drawTrack();

  let winner = null;

  horses.forEach(h => {
    if (!h.finished) {
      const staminaFactor = h.stamina > 0 ? 1 : 0.4;
      h.x += h.speed * staminaFactor;
      h.stamina -= 1;

      if (h.x >= canvas.width - 100 && !h.finished) {
        h.finished = true;
        if (!winner) winner = h;
      }
    }
  });

  if (winner) {
    finishRace(winner, bet, pick);
  } else {
    requestAnimationFrame(() => raceLoop(bet, pick));
  }
}

function finishRace(winner, bet, pick) {
  racing = false;
  let msg = `üèÜ Winner: ${winner.name}<br>`;

  if (horses[pick] === winner) {
    const payout = bet * 2;
    balance += payout;
    msg += `You won $${payout}!`;
  } else {
    msg += "You lost your bet.";
  }

  document.getElementById("result").innerHTML = msg;
  updateBalance();
}

function updateBalance() {
  document.getElementById("balance").textContent = balance;
}

createHorses();
populateSelect();
drawTrack();
updateBalance();
</script>

</body>
</html>
